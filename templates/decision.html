{% extends 'base.html' %}
{% block title %}{% block h1 %}What's your Decision?{% endblock %}{% endblock %}
{% block post_title %}{% include 'crumbs.html' with s=request.session %}{% endblock %}
{% block extra_head %}
    <style class="text/css">
        .tooltip > .tooltip-inner {
            background-color: #73AD21;
            color: #FFFFFF;
            border: 1px solid green;
            padding: 15px;
            font-size: 15px;
            max-width: 320px;
            width: 320px;
            text-align: left;
        }

        @media screen and (max-width: 500px) {
            body {
                cursor: pointer;
            }
            .btnv:hover {
                color: #fff;
                background-color: inherit;
            }
        }
    </style>
{% endblock %}
{% block content %}
    <div class="container">
        <div class="row">
            <h3 class="text-center">WHAT'S YOUR DECISION?</h3>
        </div>
        <div class="row">
            <div class="text-center">
                <div id="videos_link"><a href="#" onclick="return showVideos()">See Video Examples</a></div>
                <table id="videos" style="display: none; width: 100%;">
                    <tr>
                        <td>Watch Naomi decide if she should skip a day of school</td>
                        <td> &nbsp; </td>
                        <td>Watch Mitch decide if he should go to detention</td>
                    </tr>
                    <tr>
                        <td>
                            <iframe width="180" height="315"
                                    src="https://www.youtube.com/embed/eI18uNKEJyo?rel=0&amp;controls=0&amp;showinfo=0"
                                    frameborder="0"
                                    allowfullscreen></iframe>
                        </td>
                        <td> &nbsp; </td>
                        <td>
                            <iframe width="180" height="315"
                                    {% if request.session.partner == "apres" %}
                                    src="https://www.youtube.com/embed/AVKZOcV3hIQ?rel=0&amp;controls=0&amp;showinfo=0"
                                    {% else %}
                                    src="https://www.youtube.com/embed/CvkjxEoVKL8?rel=0&amp;controls=0&amp;showinfo=0"
                                    {% endif %}
                                    frameborder="0"
                                    allowfullscreen></iframe>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="clearfix">&nbsp;</div>
        <div class="row">
            <p class="col-md-12">
                Select the type of decision you are making. You can pick more than one!
            </p>
        </div>
        <div class="clearfix">&nbsp;</div>
        <div id="decision_types" class="row">
            <div class="decision_group col-md-4 col-sm-6 col-xs-6 text-center">
                <label class="decision_type btnv"><input type="checkbox" name="decision_type[]" value="family"/>
                    Family</label>
                <div class="info" data-toggle="tooltip"><span class="glyphicon glyphicon-info-sign"
                                                              aria-hidden="true"></span> See Example
                </div>
            </div>
            <div class="decision_group col-md-4 col-sm-6 col-xs-6 text-center">
                <label class="decision_type btnv"><input type="checkbox" name="decision_type[]" value="friends"/>
                    Friends</label>
                <div class="info" data-toggle="tooltip"><span class="glyphicon glyphicon-info-sign"
                                                              aria-hidden="true"></span> See Example
                </div>
            </div>
            <div class="decision_group col-md-4 col-sm-6 col-xs-6 text-center">
                <label class="decision_type btnv"><input type="checkbox" name="decision_type[]" value="school"/>
                    School</label>
                <div class="info" data-toggle="tooltip"><span class="glyphicon glyphicon-info-sign"
                                                              aria-hidden="true"></span> See Example
                </div>
            </div>
            <div class="decision_group col-md-4 col-sm-6 col-xs-6 text-center">
                <label class="decision_type btnv"><input type="checkbox" name="decision_type[]" value="after school"/>
                    After
                    School</label>
                <div class="info" data-toggle="tooltip"><span class="glyphicon glyphicon-info-sign"
                                                              aria-hidden="true"></span> See Example
                </div>
            </div>
            <div class="decision_group col-md-4 col-sm-6 col-xs-6 text-center">
                <label class="decision_type btnv"><input type="checkbox" name="decision_type[]" value="money related"/>
                    Money Related</label>
                <div class="info" data-toggle="tooltip"><span class="glyphicon glyphicon-info-sign"
                                                              aria-hidden="true"></span> See Example
                </div>
            </div>
            <div class="decision_group col-md-4 col-sm-6 col-xs-6 text-center">
                <label class="decision_type btnv"><input type="checkbox" name="decision_type[]" value="identity"/>
                    Identity</label>
                <div class="info" data-toggle="tooltip"><span class="glyphicon glyphicon-info-sign"
                                                              aria-hidden="true"></span> See Example
                </div>
            </div>
            <div class="decision_group col-md-4 col-sm-6 col-xs-6 text-center">
                <label class="decision_type btnv"><input type="checkbox" name="decision_type[]" value="health"/>
                    Health</label>
                <div class="info" data-toggle="tooltip"><span class="glyphicon glyphicon-info-sign"
                                                              aria-hidden="true"></span> See Example
                </div>
            </div>
            <div class="col-md-4 col-sm-6 col-xs-6 text-center">
                <label class="decision_type btnv"><input type="checkbox" name="decision_type[]" value="other"/> Other:
                </label>
            </div>
            <div class="col-md-4 col-sm-6 col-xs-6 text-center">
                <input type="text" name="decision_type_other" id="decision_type_other" size="22"
                       style="margin-top: 22px;" value="{{ request.session.decision_type_other }}"/>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-11 col-centered boeder">&nbsp;</div>
        </div>
        <div class="clearfix">&nbsp;</div>
        <div class="row">
            <h3 class="text-center">
                I am facing a<span id="types_starts_with_vowel" style="display:none">n</span> <span id="types"></span>
                challenge.
            </h3>
        </div>
        <div class="clearfix">&nbsp;</div>
        <div class="row">
            <div class="col-md-3 col-xs-4" style="padding-top:10px;font-size:13px">I need to decide:</div>
            <div class="col-md-9 col-xs-8">
                <input type="text" class="inpu" name="decision" id="decision"
                       value="{{ request.session.decision }}"/>
            </div>
        </div>
        <div class="clearfix">&nbsp;</div>
        <div class="row">
            <div class="col-md-3 col-xs-4" style="padding-top:10px;font-size:13px">I have these options:</div>
            <div class="col-md-9 col-xs-8">
                <input type="text" name="options" id="options" class="inpu"
                       value="{{ request.session.options }}"/>
            </div>
        </div>
        <div class="clearfix">&nbsp;</div>
        <div class="row">
            <div class="col-md-3 col-xs-4" style="font-size:13px">Decide by end of:</div>
            <div class="col-md-9 col-xs-8">
                <select name="timeframe" class="inpu" id="timeframe">
                    <option value=""></option>
                    <option value="day">day</option>
                    <option value="week">week</option>
                    <option value="month">month</option>
                    <option value="year">year</option>
                    <option value="sometime">sometime</option>
                </select>
            </div>
        </div>
        <div class="clearfix">&nbsp;</div>
        {% include 'buttons.html' %}
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#timeframe').val('{{ request.session.timeframe }}');
            var decision_types = '{{ decision_types }}'.split(',');
            for (var i = 0; i < decision_types.length; i++) {
                $('[name="decision_type[]"][value="' + decision_types[i] + '"]').click();
            }
            $('.decision_group').each(function () {
                var val = $(this).find(':checkbox').attr('value');
                var example = type_examples[val];
                var text = get_decision_text(val, example['decision'], example['options'], example['timeframe']);
                $(this).find('.info').attr('title', text);
            });
            $('[data-toggle="tooltip"]').tooltip();
            $('.decision_type').click(function () {
                var btn = $(this);
                var checkbox = $(this).find('input');
                if (checkbox.is(':checked')) {
                    btn.addClass('active');
                } else {
                    btn.removeClass('active');
                }
                checkbox.toggle();
            });
            $('.decision_type').each(function () {
                if ($(this).find('input').is(':checked')) {
                    $(this).addClass('active');
                }
            });
        });

        $('.tooltip').click(function () {
            $(this).hide();
        });

        var type_none = '[select type above]';
        $('#types').text(type_none);

        function showVideos() {
            $('#videos').show();
            $('#videos_link').hide();
            return false;
        }

        function updateTypes() {
            var types = '';
            var some_checked = false;
            $(':checkbox').each(function () {
                if ($(this).is(":checked")) {
                    some_checked = true;
                    var val = $(this).attr('value');
                    if (types) {
                        types += ' and ';
                    } else {
                        // an / a for the first one
                        if (val.startsWith('a') || val.startsWith('i')) {
                            $('#types_starts_with_vowel').show();
                        } else {
                            $('#types_starts_with_vowel').hide();
                        }
                    }
                    if (val == 'other') {
                        var other_type = $('#decision_type_other').val();
                        if (!other_type) {
                            other_type = '[type in details for "Other"]'
                        }
                        types += other_type
                    } else {
                        types += val;
                    }
                }
            });
            if (!types) {
                types = type_none;
            }
            $('#types').text(types);
        }

        $(':checkbox').click(updateTypes);
        $('#decision_type_other').keyup(updateTypes);

        var type_examples = {
            'none': {
                'decision': 'what is your decision?',
                'options': ' what are your options?',
                'timeframe': '',
            },
            'money related': {
                'decision': 'whether I need to get a new job so that I can make more money',
                'options': ' ask my current boss for a raise, or look for a job that pays more',
                'timeframe': 'week',
            },
            'friends': {
                'decision': 'which friend I should talk to about a personal problem',
                'options': 'Nylah, Naziyah, Brittany, and Amy',
                'timeframe': 'day',
            },
            'family': {
                'decision': 'if I should babysit my younger brother instead of going to Dream Team',
                'options': 'stay home with my brother so my mom can go to work, or ask her to stay with my brother so I can go to practice',
                'timeframe': 'day',
            },
            'school': {
                'decision': 'when I should get my homework done when I have a big basketball game tonight',
                'options': 'do it before the game, but risk being late and getting benched, or do it after the game, but risk being too tired to focus',
                'timeframe': 'day',
            },
            'after school': {
                'decision': 'what sport I should play in the fall',
                'options': 'soccer, tennis, swimming, or no sport',
                'timeframe': 'week',
            },
            'identity': {
                'decision': 'if I should come out to my parents',
                'options': 'tell both parents, tell just one parent, or don\'t tell either parent',
                'timeframe': 'week',
            },
            'health': {
                'decision': 'if I should go to the doctor for my illness',
                'options': 'go to the doctor and get a check up, or wait and see if I feel better in a few days',
                'timeframe': 'day',
            },
        }

        function validate() {
            var type_selected = false;
            $(':checkbox:checked').each(function () {
                var val = $(this).attr('value');
                if (val == 'other' && !$('#decision_type_other').val()) {
                    alert("Please type in the Other type of decision");
                    return false;
                } else {
                    type_selected = true;
                }
            });
            if (!type_selected) {
                alert("Please select one or more types");
                return false;
            }
            if (!$('#decision').val()) {
                alert("Please type in what you need to decide");
                return false;
            }
            if (!$('#options').val()) {
                alert("What are the possible outcomes");
                return false;
            }
            if (!$('#timeframe').val()) {
                alert("Please select when you need to decide");
                return false;
            }
            return true;
        }
        $('form').submit(validate);

    </script>

{% endblock %}
